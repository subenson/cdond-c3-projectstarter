---
- name: Make web directory
  become: no
  command: mkdir -p ~/web
  # file:
  #   path: ~/web
  #   state: directory

- name: "Extract Dist"
  become: no
  unarchive:
    src: "{{ artifact_filename }}"
    dest: ~/web/

- name: "install pm2"
  become: yes
  chdir: ~/web
  command: npm install

- name: "stop pm2"
  become: no
  chdir: ~/web
  command: pm2 stop default

- name: "start pm2"
  become: no
  chdir: ~/web
  command: pm2 start npm -- start
